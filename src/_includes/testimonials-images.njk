{% set pageTestimonials = testimonials[type][locale] or testimonials[type]['fr'] or [] %}
{% if pageTestimonials and pageTestimonials.length > 0 %}
<style>
@layer components {
  .testimonials-container {
    max-width: 72rem;
    margin: 0 auto;
    padding: var(--spacing-3xl) var(--spacing-xl);
  }

  .testimonials-header {
    text-align: center;
    margin-bottom: var(--spacing-3xl);
    gap: var(--spacing-lg);
    display: flex;
    flex-direction: column;
  }

  .testimonials-header h2 {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--primary-color);
  }

  .testimonials-header p {
    font-size: 1.125rem;
    color: var(--text-muted);
  }

  .testimonials-grid {
    gap: var(--spacing-xl);
    display: grid;
    grid-template-columns: 1fr;
  }

  .testimonial-card {
    border-radius: var(--border-radius-xl);
    border: 1px solid rgba(45, 80, 22, 0.15);
    background: var(--white);
    box-shadow: var(--shadow);
    padding: var(--spacing-lg);
    overflow: hidden;
  }

  .testimonial-card img {
    width: 100%;
    height: auto;
    border-radius: var(--border-radius-lg);
  }

  .testimonial-rating {
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
  }

  .testimonial-stars {
    gap: var(--spacing-xs);
    display: flex;
  }

  .star-filled {
    width: 1.25rem;
    height: 1.25rem;
    color: #facc15;
  }

  .star-empty {
    width: 1.25rem;
    height: 1.25rem;
    color: #d1d5db;
  }

  .testimonial-text {
    color: var(--text-muted);
    margin-bottom: var(--spacing-lg);
    font-style: italic;
  }

  .testimonial-footer {
    gap: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid rgba(45, 80, 22, 0.2);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .testimonial-author {
    gap: var(--spacing-xs);
    display: flex;
    flex-direction: column;
  }

  .testimonial-author-name {
    font-weight: 600;
    color: var(--primary-color);
  }

  .testimonial-author-source {
    font-size: 0.875rem;
    color: var(--text-light);
  }

  .testimonial-date {
    font-size: 0.875rem;
    color: var(--text-light);
  }

  @container (min-width: 768px) {
    .testimonials-container {
      padding: var(--spacing-3xl) var(--spacing-3xl);
    }

    .testimonials-header h2 {
      font-size: 2.25rem;
    }

    .testimonials-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @container (min-width: 1024px) {
    .testimonials-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
}
</style>

<section id="testimonials" class="testimonials-container">
  <div class="testimonials-header">
    <h2>
      {% if locale == 'fr' %}Témoignages{% elif locale == 'en' %}Testimonials{% elif locale == 'de' %}Testimonials{% elif locale == 'es' %}Testimonios{% else %}Depoimentos{% endif %}
    </h2>
    <p>
      {% if locale == 'fr' %}Ce que nos hôtes disent{% elif locale == 'en' %}What our guests say{% elif locale == 'de' %}Was unsere Gäste sagen{% elif locale == 'es' %}Lo que dicen nuestros huéspedes{% else %}O que nossos hóspedes dizem{% endif %}
    </p>
  </div>

  <div class="testimonials-grid">
    {% for testimonial in pageTestimonials %}
    <div class="testimonial-card">
      {% if testimonial.image %}
        {% set imagePath = "assets/img/testimonials/" + testimonial.image %}
        {% set imageAlt = testimonial.alt or "Témoignage client" %}
        {% image imagePath, imageAlt, "w-full h-auto rounded-lg", "lazy" %}
      {% elif testimonial.text %}
        {# Fallback pour témoignages texte si nécessaire #}
        <div class="testimonial-rating">
          <div class="testimonial-stars">
            {% for i in range(1, 6) %}
              {% if i <= (testimonial.rating or 5) %}
                <svg class="star-filled" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              {% else %}
                <svg class="star-empty" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        <p class="testimonial-text">"{{ testimonial.text }}"</p>
        <div class="testimonial-footer">
          <div class="testimonial-author">
            <p class="testimonial-author-name">{{ testimonial.author }}</p>
            {% if testimonial.source %}<p class="testimonial-author-source">{{ testimonial.source }}</p>{% endif %}
          </div>
          {% if testimonial.date %}<p class="testimonial-date">{{ testimonial.date | date("MMM yyyy", locale) }}</p>{% endif %}
        </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}
