<header class="site-header">
  <div class="header-container">
    {% set t = translations[locale] or translations['fr'] %}
    {% if locale == 'fr' %}
    <a href="{{ '/fr/' | relativeUrl }}" class="logo-link">
    {% elif locale == 'en' %}
    <a href="{{ '/en/' | relativeUrl }}" class="logo-link">
    {% elif locale == 'de' %}
    <a href="{{ '/de/' | relativeUrl }}" class="logo-link">
    {% elif locale == 'es' %}
    <a href="{{ '/es/' | relativeUrl }}" class="logo-link">
    {% elif locale == 'pt' %}
    <a href="{{ '/pt/' | relativeUrl }}" class="logo-link">
    {% else %}
    <a href="{{ '/fr/' | relativeUrl }}" class="logo-link">
    {% endif %}
      {% image "assets/img/logo-cc.jpg", "C & C Logo", "header-logo", "eager", "" %}
    </a>

    <button class="mobile-menu-toggle" data-menu-toggle aria-label="Open menu">
      <svg class="hamburger-icon" fill="none" stroke="currentColor" stroke-width="1.7" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M4 12h16M4 17h16" />
      </svg>
    </button>

    <nav class="main-nav" data-menu>
      <a href="{{ '/' + locale + '/eco-studio/' | relativeUrl }}" class="nav-link">{{ t.ecoStudio }}</a>
      <a href="{{ '/' + locale + '/parking/' | relativeUrl }}" class="nav-link">{{ t.menuParking }}</a>
      <a href="{{ '/' + locale + '/location/' | relativeUrl }}" class="nav-link">{{ t.location }}</a>
      <a href="{{ '/' + locale + '/about/' | relativeUrl }}" class="nav-link">{{ t.menuAbout }}</a>
      <a href="{{ '/' + locale + '/contact/' | relativeUrl }}" class="nav-link">{{ t.contact }}</a>

      <div class="language-selector">
        <button class="lang-toggle" data-lang-toggle aria-label="Changer de langue">
          {% set langNames = {'fr': 'FR', 'en': 'EN', 'de': 'DE', 'es': 'ES', 'pt': 'PT'} %}
          {{ langNames[locale] }}
          <svg class="lang-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none">
            <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div class="lang-dropdown">
          {% set languages = ['fr', 'en', 'de', 'es', 'pt'] %}
          {% set langFullNames = {'fr': 'Français', 'en': 'English', 'de': 'Deutsch', 'es': 'Español', 'pt': 'Português'} %}
          {% for lang in languages %}
            {% if lang != locale %}
              {% set currentUrl = page.url %}
              {% if lang == 'fr' %}
                {% set targetUrl = currentUrl | replace('/en/', '/fr/') | replace('/de/', '/fr/') | replace('/es/', '/fr/') | replace('/pt/', '/fr/') %}
                {% if targetUrl == '' %}{% set targetUrl = '/fr/' %}{% endif %}
              {% else %}
                {% set langPrefix = '/' + lang + '/' %}
                {% if currentUrl == '/' %}
                  {% set targetUrl = langPrefix %}
                {% else %}
                  {% set targetUrl = currentUrl | replace('/fr/', langPrefix) | replace('/en/', langPrefix) | replace('/de/', langPrefix) | replace('/es/', langPrefix) | replace('/pt/', langPrefix) %}
                  {% if targetUrl == currentUrl %}
                    {% set targetUrl = '/' + lang + currentUrl %}
                  {% endif %}
                {% endif %}
              {% endif %}
              <a href="{{ targetUrl | relativeUrl }}" class="lang-option">
                <span class="lang-code">{{ langNames[lang] }}</span>
                <span class="lang-name">{{ langFullNames[lang] }}</span>
              </a>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </nav>
  </div>

  <!-- Mobile menu -->
  <nav class="mobile-nav hidden" data-menu-mobile>
    <a href="{{ '/' + locale + '/eco-studio/' | relativeUrl }}" class="mobile-nav-link">{{ t.ecoStudio }}</a>
    <a href="{{ '/' + locale + '/parking/' | relativeUrl }}" class="mobile-nav-link">{{ t.menuParking }}</a>
    <a href="{{ '/' + locale + '/location/' | relativeUrl }}" class="mobile-nav-link">{{ t.location }}</a>
    <a href="{{ '/' + locale + '/about/' | relativeUrl }}" class="mobile-nav-link">{{ t.menuAbout }}</a>
    <a href="{{ '/' + locale + '/contact/' | relativeUrl }}" class="mobile-nav-link">{{ t.contact }}</a>

    <div class="mobile-language-selector">
      <button class="mobile-lang-toggle" data-mobile-lang-toggle>
        {% set langNames = {'fr': 'FR', 'en': 'EN', 'de': 'DE', 'es': 'ES', 'pt': 'PT'} %}
        <span>{{ langNames[locale] }}</span>
        <svg class="mobile-lang-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <div class="mobile-lang-dropdown">
        {% set languages = ['fr', 'en', 'de', 'es', 'pt'] %}
        {% set langFullNames = {'fr': 'Français', 'en': 'English', 'de': 'Deutsch', 'es': 'Español', 'pt': 'Português'} %}
        {% for lang in languages %}
          {% if lang != locale %}
            {% set currentUrl = page.url %}
            {% if lang == 'fr' %}
              {% set targetUrl = currentUrl | replace('/en/', '/fr/') | replace('/de/', '/fr/') | replace('/es/', '/fr/') | replace('/pt/', '/fr/') %}
              {% if targetUrl == currentUrl %}
                 {# If no replacement happened, check if we are at root /en/ or similar which might have been handled, or if we are at a page that needs prefixing #}
                 {# But actually, checking if targetUrl == currentUrl suggests we might be on a page that doesn't have the prefix yet? No, we are generating links FOR other languages FROM current page. #}
                 {# If we are on /en/parking/, replace works. #}
                 {# If we are on / (root), currentUrl is /. #}
                 {% if currentUrl == '/' %}
                    {% set targetUrl = '/fr/' %}
                 {% endif %}
              {% endif %}
              {% if targetUrl == '' %}{% set targetUrl = '/fr/' %}{% endif %}
            {% else %}
              {% set langPrefix = '/' + lang + '/' %}
              {% if currentUrl == '/' %}
                {% set targetUrl = langPrefix %}
              {% else %}
                {% set targetUrl = currentUrl | replace('/fr/', langPrefix) | replace('/en/', langPrefix) | replace('/de/', langPrefix) | replace('/es/', langPrefix) | replace('/pt/', langPrefix) %}
                {% if targetUrl == currentUrl %}
                  {% set targetUrl = '/' + lang + currentUrl %}
                {% endif %}
              {% endif %}
            {% endif %}
            <a href="{{ targetUrl | relativeUrl }}" class="mobile-lang-option">
              <span class="lang-code">{{ langNames[lang] }}</span>
              <span class="lang-name">{{ langFullNames[lang] }}</span>
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </nav>
</header>
